# APIãƒ†ã‚¹ãƒˆä¾‹

## å¤‰æ›´å¾Œã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä½¿ç”¨ä¾‹

### 1. ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§é¸æŠã•ã‚ŒãŸã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨ã™ã‚‹ã‚±ãƒ¼ã‚¹

ã‚¨ãƒƒã‚¸ãƒ‡ãƒã‚¤ã‚¹ï¼ˆRaspberry Piï¼‰ãŒãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠã‚’è¡Œã„ã€ãã®çµæœã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã—ã¾ã™ã€‚

```bash
# PCAPãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢é¸æŠã‚ã‚Šï¼‰
curl -X POST "http://localhost:8000/breathing-analysis/upload-csi" \
  -H "Authorization: Bearer test-key-123" \
  -F "file=@measurement_data.pcap" \
  -F 'metadata={
    "type": "measurement",
    "device_id": "rpi-device-001",
    "timestamp": 1700000000,
    "collection_duration": 60,
    "channel_width": "80MHz",
    "location": "bedroom",
    "selected_subcarriers": ["-45", "-23", "12", "34", "56"]
  }'
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
- ã‚µãƒ¼ãƒãƒ¼ã¯ `selected_subcarriers` ã‚’æ¤œå‡º
- ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§é¸æŠã•ã‚ŒãŸ5ã¤ã®ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ `["-45", "-23", "12", "34", "56"]` ã‚’ä½¿ç”¨
- ãƒ­ã‚°ã«ã€Œãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§é¸æŠã•ã‚ŒãŸã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨ã€ã¨è¨˜éŒ²
- IPFS ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã¿ï¼‰

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "success": true,
  "message": "CSI file processed successfully",
  "analysis_id": "550e8400-e29b-41d4-a716-446655440000",
  "breathing_rate": 16.5,
  "timestamp": "2023-11-15T10:00:00"
}
```

---

### 2. ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠãªã—ï¼ˆå¾“æ¥ã®æ–¹æ³•ï¼‰

ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠã‚’è¡Œã‚ãªã„å ´åˆã€ã‚µãƒ¼ãƒãƒ¼å´ã§è‡ªå‹•é¸æŠã•ã‚Œã¾ã™ã€‚

```bash
# PCAPãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠãªã—ï¼‰
curl -X POST "http://localhost:8000/breathing-analysis/upload-csi" \
  -H "Authorization: Bearer test-key-123" \
  -F "file=@measurement_data.pcap" \
  -F 'metadata={
    "type": "measurement",
    "device_id": "rpi-device-002",
    "timestamp": 1700000000,
    "collection_duration": 60,
    "channel_width": "80MHz",
    "location": "living_room"
  }'
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
- `selected_subcarriers` ãŒãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«å«ã¾ã‚Œã¦ã„ãªã„
- ã‚µãƒ¼ãƒãƒ¼å´ã§ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã¨ã®é¡ä¼¼åº¦è¨ˆç®—ã«ã‚ˆã‚Šè‡ªå‹•é¸æŠ
- ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãŒãªã„å ´åˆã¯ã™ã¹ã¦ã®ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨
- ãƒ­ã‚°ã«ã€Œã‚µãƒ¼ãƒãƒ¼å´ã§ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’é¸æŠã€ã¾ãŸã¯ã€Œãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ãŒãªã„ãŸã‚ã€ã™ã¹ã¦ã®ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨ã€ã¨è¨˜éŒ²

---

### 3. å‘¼å¸è§£æãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢é¸æŠã‚ã‚Šï¼‰

```bash
curl -X POST "http://localhost:8000/breathing-analysis/analyze" \
  -H "Authorization: Bearer test-key-123" \
  -H "Content-Type: application/json" \
  -d '{
    "window_results": [
      {
        "timestamp": "2023-11-15T10:00:00",
        "breathing_rate": 16.5,
        "selected_subcarriers": ["-45", "-23", "12", "34", "56"]
      },
      {
        "timestamp": "2023-11-15T10:01:00",
        "breathing_rate": 17.2,
        "selected_subcarriers": ["-45", "-23", "12", "34", "56"]
      }
    ],
    "summary": {
      "total_windows": 2,
      "average_breathing_rate": 16.85,
      "std_breathing_rate": 0.35,
      "min_breathing_rate": 16.5,
      "max_breathing_rate": 17.2
    },
    "metadata": {
      "device_id": "rpi-device-001",
      "analysis_timestamp": "2023-11-15T10:02:00",
      "version": "1.0.0",
      "location": "bedroom",
      "channel_width": "80MHz",
      "collection_duration": 120
    }
  }'
```

**æœŸå¾…ã•ã‚Œã‚‹å‹•ä½œ:**
- è§£æçµæœã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
- IPFS ã¸ã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¯ã‚¹ã‚­ãƒƒãƒ—
- ãƒ­ã‚°ã«ã€ŒIPFSé€£æºã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã¿ä½¿ç”¨ï¼‰ã€ã¨è¨˜éŒ²

---

### 4. è§£æçµæœã®å–å¾—

```bash
# ãƒ‡ãƒã‚¤ã‚¹IDã§è§£æçµæœã‚’å–å¾—
curl -X GET "http://localhost:8000/breathing-analysis/results/rpi-device-001?limit=10" \
  -H "Authorization: Bearer test-key-123"
```

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:**
```json
{
  "device_id": "rpi-device-001",
  "results": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "device_id": "rpi-device-001",
      "timestamp": 1700000000,
      "breathing_rate": 16.5,
      "peak_frequency": 0.275,
      "peak_height": 0.85,
      "selected_subcarriers": ["-45", "-23", "12", "34", "56"],
      "location": "bedroom",
      "collection_duration": 60,
      "channel_width": "80MHz",
      "result_file_path": "/app/data/analysis/breathing_analysis_20231115_100000.json",
      "processed_at": "2023-11-15T10:00:30"
    }
  ],
  "count": 1,
  "retrieved_at": "2023-11-15T10:05:00"
}
```

---

## å¤‰æ›´å†…å®¹ã®ã‚µãƒãƒªãƒ¼

### âœ… å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½

1. **IPFSä¿å­˜ã®ç„¡åŠ¹åŒ–**
   - `analysis/breathing_analysis.py` ã§IPFSé€£æºã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
   - ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ (`/app/data/analysis/`) ã®ã¿ã‚’ä½¿ç”¨
   - ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§ç„¡åŠ¹åŒ–ã‚’æ˜ç¤º

2. **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠã®å¯¾å¿œ**
   - `api/models/breathing_analysis.py` ã® `CSIDataMetadata` ã« `selected_subcarriers` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
   - `analysis/csi_processor.py` ã§ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‹ã‚‰ã®é¸æŠã‚’å„ªå…ˆä½¿ç”¨
   - é¸æŠãŒãªã„å ´åˆã¯å¾“æ¥ã®ã‚µãƒ¼ãƒãƒ¼å´é¸æŠãƒ­ã‚¸ãƒƒã‚¯ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

3. **å„ªå…ˆé †ä½**
   - å„ªå…ˆåº¦1: ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢é¸æŠã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ï¼ˆ`metadata.selected_subcarriers`ï¼‰
   - å„ªå…ˆåº¦2: ã‚µãƒ¼ãƒãƒ¼å´ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¯”è¼ƒé¸æŠ
   - å„ªå…ˆåº¦3: ã™ã¹ã¦ã®ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨

### ğŸ” ãƒ†ã‚¹ãƒˆçµæœ

ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒåˆæ ¼ã—ã¾ã—ãŸï¼š
- âœ“ ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢é¸æŠãƒ­ã‚¸ãƒƒã‚¯ãŒæ­£ã—ãå‹•ä½œ
- âœ“ IPFSä¿å­˜ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹
- âœ“ ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ãŒæ­£ã—ãæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- âœ“ CSIãƒ—ãƒ­ã‚»ãƒƒã‚µãƒ¼ã®ãƒ­ã‚¸ãƒƒã‚¯ãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹

### ğŸ“ ãƒ­ã‚°ä¾‹

**ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢é¸æŠä½¿ç”¨æ™‚:**
```
INFO - ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã§é¸æŠã•ã‚ŒãŸã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’ä½¿ç”¨: ['-45', '-23', '12', '34', '56']
INFO - è§£æçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: /app/data/analysis/breathing_analysis_20231115_100000.json
INFO - IPFSé€£æºã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã¿ä½¿ç”¨ï¼‰
```

**ã‚µãƒ¼ãƒãƒ¼å´é¸æŠæ™‚:**
```
INFO - ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚µãƒ–ã‚­ãƒ£ãƒªã‚¢ã‚’é¸æŠ: ['-64', '-62', '-45', '34', '62']
INFO - è§£æçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ: /app/data/analysis/breathing_analysis_20231115_100000.json
INFO - IPFSé€£æºã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã¿ä½¿ç”¨ï¼‰
```
